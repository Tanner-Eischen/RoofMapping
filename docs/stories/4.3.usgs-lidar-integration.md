# Story 4.3: USGS LiDAR Data Integration

## Status
Completed

## Story
**As an** ML service
**I want** to fetch USGS 3DEP LiDAR elevation data
**So that** I can calculate roof pitch and slope

## Acceptance Criteria
- [x] USGS client created (`src/ml/lidar/usgs.ts`)
- [x] LiDAR query implemented via external API proxy
- [x] Point density exposed and included in results
- [x] Error handling for unavailable LiDAR data
- [x] Fallback to satellite-only path when LiDAR is missing
- [x] Polite retries on request failures

## Tasks / Subtasks
- [x] Implement USGS client and query via proxy (AC: 1-2)
- [ ] Coordinate transformation utilities (AC: 3-4)
- [x] Error fallback for no LiDAR and basic quality checks (AC: 5-7)

## Dev Notes
- ML pipeline data sources: [../architecture/ml-processing-pipeline.md#external-data-clients](../architecture/ml-processing-pipeline.md#external-data-clients)
- Measurement service: [../architecture/ml-processing-pipeline.md#measurement-service](../architecture/ml-processing-pipeline.md#measurement-service)
- External integrations: [../architecture/external-integrations.md#usgs-3dep](../architecture/external-integrations.md#usgs-3dep)
- Error handling & fallbacks: [../architecture/error-handling-resilience.md#fallback-mechanisms](../architecture/error-handling-resilience.md#fallback-mechanisms)
- PRD traceability: [../prd/12-epic-and-story-structure.md#story-43-usgs-lidar-data-integration](../prd/12-epic-and-story-structure.md#story-43-usgs-lidar-data-integration)

## Dependencies
- 4.1 Lambda Handler & Service Architecture
- 3.2 SQS Queue Integration (job context)

## Estimate
M (medium)

## Priority
P1

## Assumptions
- USGS API provides required elevation tiles or point cloud data.
- Coordinate transformations use a vetted library and EPSG codes.
- Data quality checks are defined and enforce minimum thresholds.

## Edge Cases
- No LiDAR available; fallback to satellite-only pitch estimation.
- Mismatched coordinate systems leading to misalignment.
- Rate-limiting on USGS endpoints; implement polite retries.

### Testing
- Unit: transformation utilities and quality checks.
- Integration: mocked USGS responses for presence/absence of LiDAR.
- Fallback: ensure satellite-only path activates and returns consistent output.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-13 | v1 | Initial draft created | Scrum Master |

## Dev Agent Record
- Agent Model Used: 
- Debug Log References: 
- Completion Notes List: 
- File List: 

## QA Results
- Pending