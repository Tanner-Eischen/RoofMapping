# Story 5.4: ML Pipeline Testing

## Status
Draft

## Story
**As a** developer
**I want** tests for the ML processing pipeline
**So that** measurement accuracy is validated

## Acceptance Criteria
- [ ] Pytest configured for Python code
- [ ] Test: Sentinel client with mocked API
- [ ] Test: USGS client with mocked API
- [ ] Test: Roof detection with sample images
- [ ] Test: Measurement calculations with known roofs
- [ ] Test: Accuracy validation (±3% target)
- [ ] Mock external API calls to avoid rate limits

## Tasks / Subtasks
- [ ] Configure Pytest for ML service (AC: 1)
- [ ] Add mocked tests for clients and detection (AC: 2-4)
- [ ] Validate measurement outputs (AC: 5-6)
- [ ] Mock external APIs (AC: 7)

## Dev Notes
- ML pipeline components: [../architecture/ml-processing-pipeline.md#lambda-handler-architecture](../architecture/ml-processing-pipeline.md#lambda-handler-architecture), [../architecture/ml-processing-pipeline.md#measurement-service](../architecture/ml-processing-pipeline.md#measurement-service)
- External data clients: [../architecture/ml-processing-pipeline.md#external-data-clients](../architecture/ml-processing-pipeline.md#external-data-clients)
- Testing strategy: [../architecture/development-workflow.md#testing-strategy](../architecture/development-workflow.md#testing-strategy)
- PRD traceability: [../prd/12-epic-and-story-structure.md#story-54-ml-pipeline-testing](../prd/12-epic-and-story-structure.md#story-54-ml-pipeline-testing)

## Dependencies
- ML service modules implemented (Epic 4)

## Estimate
M (medium)

## Priority
P0

## Assumptions
- Pytest environment mirrors production dependencies where feasible.
- External calls mocked to avoid rate limiting and costs.
- Fixtures include known roofs for accuracy checks.

## Edge Cases
- Token expiry for mocked clients; ensure handling.
- Variability in detection due to non-determinism; stabilize seeds.
- Large images causing memory issues; test with limits.

### Testing
- Unit: clients, detection, and measurement math with fixtures.
- Integration: pipeline from input to outputs with mocks.
- Accuracy: assert ±3% tolerance against reference data.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-13 | v1 | Initial draft created | Scrum Master |

## Dev Agent Record
- Agent Model Used: 
- Debug Log References: 
- Completion Notes List: 
- File List: 

## QA Results
- Pending