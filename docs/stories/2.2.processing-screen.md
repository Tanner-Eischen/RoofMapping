# Story 2.2: Processing Screen (Screen 2)

## Status
Draft

## Story
**As a** contractor
**I want** to see a loading state while my analysis processes
**So that** I know the system is working

## Acceptance Criteria
- [ ] Processing page implemented (`app/analyze/page.tsx`)
- [ ] Spinning loader with sage green color
- [ ] Display submitted address
- [ ] Status text: "Analyzing Roof" and "Processing satellite and LiDAR data..."
- [ ] Automatic navigation from Screen 1
- [ ] Poll for results every 2 seconds (starts after 2 seconds)
- [ ] Poll starts 2 seconds after page load (not immediately)
- [ ] Poll interval: exactly 2 seconds between requests
- [ ] Stop polling on navigation away from page
- [ ] Show 'Taking longer than expected' message after 30s
- [ ] Navigate to results when status = "completed"
- [ ] Navigate to mobile assist when status = "needs_assist"
- [ ] Timeout after 30s: show retry button
- [ ] Timeout after 60s: redirect to mobile assist

## Tasks / Subtasks
- [ ] Implement `app/analyze/page.tsx` with loader and address (AC: 1-3)
- [ ] Add status copy and timing behaviors (AC: 4, 6-10)
- [ ] Implement polling with 2s delay and interval (AC: 6-8)
- [ ] Handle navigation on status changes (AC: 11-12)
- [ ] Implement timeouts and retry flow (AC: 13-14)

## Dev Notes
- Polling/state management: [../architecture/frontend-architecture.md#state-management](../architecture/frontend-architecture.md#state-management)
- API service layer: [../architecture/frontend-architecture.md#api-service-layer](../architecture/frontend-architecture.md#api-service-layer)
- Routing: [../architecture/frontend-architecture.md#routing](../architecture/frontend-architecture.md#routing)
- PRD traceability: [../prd/12-epic-and-story-structure.md#story-22-processing-screen-screen-2](../prd/12-epic-and-story-structure.md#story-22-processing-screen-screen-2)

## Dependencies
- 2.1 Address Input Screen implemented
- 3.3 Results retrieval endpoint available
- 1.4 Environment configuration (API base URL)

## Estimate
M (medium)

## Priority
P0

## Assumptions
- Status API returns `queued`, `processing`, `completed`, `needs_assist`.
- Polling delays and intervals are reliable across devices.
- Navigation guards prevent duplicate requests on route change.

## Edge Cases
- Polling continues when tab is backgrounded; ensure throttling.
- API intermittent failures; should retry/backoff gracefully.
- Long processing times; show informative fallback messages.

### Testing
- E2E: verify status transitions drive correct navigation.
- Timing: initial 2s delay; 2s interval maintained exactly.
- Resilience: retries on transient failures, stop on unmount.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-13 | v1 | Initial draft created | Scrum Master |

## Dev Agent Record
- Agent Model Used: 
- Debug Log References: 
- Completion Notes List: 
- File List: 

## QA Results
- Pending